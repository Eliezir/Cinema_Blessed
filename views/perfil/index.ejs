<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--  Boostrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
    </script>
  <!-- favicon -->
  <link rel="shortcut icon" href="imagens/abençoados.ico" type="image/x-icon">
  <!-- GoogleFonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap" rel="stylesheet">
  <!-- fontawesome -->
  <script src="https://kit.fontawesome.com/e06ad0a210.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Css -->
  <link rel="stylesheet" href="stylesheets/stylePerfil.css">
  <link rel="stylesheet" href="stylesheets/default.css">
<!-- jquery -->
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  <title>The Blessed</title>
</head>
<body>
  <%- include('../navbar.ejs') %>
  <div class="container-fluid main-container">
  <header>
    <div class="userPerfil">
      <div class="icon"></div>
      <h2 class="Nome">
        <%= usuario.user %>
      </h2>
    </div>
      <button class='btn-create' data-bs-toggle="modal" data-bs-target="#modalC"> +</button>
    </header>
   
    <div class="comentarios">
      <% comentarios.forEach(function(comentario,index){ %>
        <div class="comentario">
          <h3>
            <%- comentario.filme%>
              </h1>
              <div class="crud-icons">
               <!--  define o id do botão com o index do comentario  no array comentarios -->
                <div onClick='setEditId(this.id )' id=<%-index%>  class="icon-edit" data-bs-toggle="modal" data-bs-target="#modalEdit">
                  <i class="fa-solid fa-pencil"></i>
                </div>
                <div onClick='setId(this.id)' id=<%-index%>  class="icon-delete" data-bs-toggle="modal" data-bs-target="#modalDelete">
                  <i class="fa-solid fa-trash"></i>
                </div>
                <div onClick=' setShowStars(); setShowId(this.id )' class="icon-show" id=<%-index%>  class="icon-delete" data-bs-toggle="modal" data-bs-target="#modalShow">
                  <i class="fa-solid fa-info"></i>
                </div>

              </div>
               <img  class='posterComentario' src="imagens/posters/<%-comentario.poster%> ">
              <div class="rating">
                <% for(var e=0; e < Math.floor(comentario.nota); e++){%>
                  <span class="fa fa-star checked"></span>
                  <%}%>
                    <%if(comentario.nota % 1 !=0){%>
                      <span class="fa fa-star-half-o  checked"></span>
                      <%}%>
                        <% for(var e=0; e < Math.floor(5 - comentario.nota); e++){%>
                          <span class="fa fa-star-o checked"></span>
                          <%}%>
              </div>
        </div>
        <%})%>

       <!--  Modais CRUD -->
       <%- include('./modal/createModal.ejs')%> 
       <%- include('./modal/showModal.ejs', {star: 'teste'}) %>
       <%- include('./modal/editModal.ejs')%>
        <%- include('./modal/deleteModal.ejs')%>
    </div>
    <a href="/sair">Sair</a>
  </div>
    <%- include('../footer.ejs') %>
    <script src="JS/perfil.js"></script>
    <script>

    /*   Função para exibir os valores no modal de editar comentarios */
     function setEditId(index){ 
      /* aqui ele fala que da erro mas roda normal */
       // @ts-ignore
      let user =  <%-JSON.stringify(usuario)%>
      console.log();
      document.getElementById('editButton').action = `/perfil/comentario/${index}/editar`
      document.getElementById('filmeTitleEdit').value   =user.comentarios[index].filme;
      document.getElementById('inputNota').value = user.comentarios[index].nota;
      document.getElementById('inputComentarioEdit').value = user.comentarios[index].review
      document.getElementById('posterModalEdit').src = `imagens/posters/${user.comentarios[index].poster}`
      document.getElementById("filmePosterEdit").value = user.comentarios[index].poster
      document.getElementById(`EditStar`+ user.comentarios[index].nota).click();
    }

    function setShowId(index){ 
      /* aqui ele fala que da erro mas roda normal */
       // @ts-ignore
      let user =  <%-JSON.stringify(usuario)%>
      console.log();
      document.getElementById('showFilmeTitle').innerHTML  = user.comentarios[index].filme;
      document.getElementById('inputNotaShow').value = user.comentarios[index].nota;
      document.getElementById('inputComentarioShow').value = user.comentarios[index].review
      document.getElementById('posterModalShow').src = `imagens/posters/${user.comentarios[index].poster}`
      document.getElementById('inputNotaShow').value = user.comentarios[index].nota;
      document.getElementById(`readStars`+ user.comentarios[index].nota).click();
      
    }
    </script>
</body>
</html>